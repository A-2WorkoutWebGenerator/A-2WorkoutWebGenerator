<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
        <link rel="stylesheet" href="WoW.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
        <title>Success Stories - FitGen</title>
    </head>
    <body>
        <div class="page-wrapper">
            <nav class="navbar">
                <div class="logo">
                    <a href="WoW-Logged.html"><span>FitGen</span></a>
                </div>
                <div class="nav-links">
                    <div class="dropdown">
                        <a href="#workouts" class="nav-link">Workout routines</a>
                        <div class="dropdown-content">
                            <a href="physiotherapy.html">Physiotherapy</a>
                            <a href="kinetotherapy.html">Kinetotherapy</a>
                            <div class="nested-dropdown">
                                <a href="#sports" class="nested-link">Sports</a>
                                <div class="nested-dropdown-content">
                                    <a href="football.html">Football</a>
                                    <a href="basketball.html">Basketball</a>
                                    <a href="tennis.html">Tennis</a>
                                    <a href="swimming.html">Swimming</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <a href="champions.html" class="nav-link">Champions</a>
                    <a href="success-stories.html" class="nav-link">Success stories</a>
                    <a href="contact.html" class="nav-link">Contacts</a>
                </div>
                <div class="nav-buttons">
                    <a href="profile.html" class="btn btn-outline">Profile</a>
                    <a href="WoW.html" class="btn btn-outline">Logout</a>
                </div>
                <div class="mobile-toggle">
                    <i class="fas fa-bars"></i>
                </div>
            </nav>

            <section class="hero">
                <div class="container">
                    <div class="hero-content">
                        <h1>Success Stories</h1>
                        <p>Read inspiring stories from our community members and share your own transformation journey.</p>
                        <div class="hero-buttons">
                            <a href="#stories" class="btn btn-primary btn-large">Read Stories</a>
                            <a href="#share-story" class="btn btn-outline btn-large">Share Your Story</a>
                        </div>
                    </div>
                    <div class="hero-image-container">
                        <div class="image-frame fullsize-image">
                            <img src="images/success.jpeg" alt="Success Stories">
                        </div>
                    </div>
                </div>
            </section>

            <section id="stories" class="testimonials">
                <div class="section-header">
                    <h2>Inspiring Transformations</h2>
                    <p>Real stories from real people who achieved their fitness goals</p>
                </div>
                
                <!-- Stories info -->
                <div class="stories-info">
                    <p id="stories-count">Loading stories...</p>
                </div>
                
                <!-- Stories grid -->
                <div id="user-stories" class="user-stories-grid"></div>
                
                <!-- Pagination -->
                <div class="pagination-container">
                    <div class="pagination">
                        <button id="prev-btn" class="pagination-btn" disabled>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        
                        <div class="pagination-numbers" id="pagination-numbers"></div>
                        
                        <button id="next-btn" class="pagination-btn" disabled>
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </section>

            <section id="share-story" class="cta">
                <div class="cta-content">
                    <h2>Tell Your Story</h2>
                    <p>Have you achieved your fitness goals with FitGen? Share your journey and inspire others!</p>
                    
                    <form id="story-form" class="story-form">
                        <div class="form-group">
                            <label for="user-name">Your Name:</label>
                            <input type="text" id="user-name" name="userName" required placeholder="Enter your name">
                        </div>
                        
                        <div class="form-group">
                            <label for="achievement">Your Achievement:</label>
                            <input type="text" id="achievement" name="achievement" required placeholder="e.g., Lost 10kg, Completed first marathon">
                        </div>
                        
                        <div class="form-group">
                            <label for="story-text">Your Story:</label>
                            <textarea id="story-text" name="storyText" rows="6" required placeholder="Tell us about your fitness journey with FitGen. What challenges did you overcome? What helped you succeed?"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-large">Share My Story</button>
                    </form>
                    
                    <div id="success-message" class="success-message" style="display: none;">
                        <i class="fas fa-check-circle"></i>
                        <p>Thank you for sharing your story! It has been added to our success stories.</p>
                    </div>
                </div>
            </section>

            <footer class="footer">
                <div class="footer-top">
                    <div class="footer-brand">
                        <div class="logo">FitGen</div>
                        <p>Transform Your Workout Experience</p>
                    </div>
                    <div class="footer-links">
                        <div class="footer-links-column">
                            <ul>
                                <li><a href="contact.html">Contact Us</a></li>
                                <li><a href="credits.html">Credits</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2025 FitGen. All rights reserved.</p>
                </div>
            </footer>
        </div>

        <style>
            .user-stories-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                gap: 2rem;
                margin-top: 2rem;
            }

            .user-story-card {
                background-color: var(--primary-light);
                border-radius: var(--radius-md);
                padding: 2rem;
                box-shadow: var(--shadow-sm);
                transition: all var(--transition-normal);
                border-left: 4px solid var(--primary);
            }

            .user-story-card:hover {
                transform: translateY(-5px);
                box-shadow: var(--shadow-md);
            }

            .user-story-header {
                display: flex;
                align-items: center;
                margin-bottom: 1.5rem;
            }

            .user-author-image {
                width: 50px;
                height: 50px;
                border-radius: 50%;
                background-color: var(--primary);
                margin-right: 1rem;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
                font-size: 1.2rem;
            }

            .user-author-info h4 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
                color: var(--text-dark);
            }

            .user-author-info span {
                font-size: 1rem;
                color: var(--primary);
                font-weight: 600;
                display: block;
                margin-bottom: 0.8rem;
            }

            .user-story-date {
                font-size: 0.9rem;
                color: var(--text-light);
            }

            .user-story-content p {
                color: var(--text-dark);
                line-height: 1.7;
                font-style: italic;
                font-size: 1.1rem;
            }

            .story-form {
                max-width: 600px;
                margin: 2rem auto;
                text-align: left;
            }

            .form-group {
                margin-bottom: 1.5rem;
            }

            .form-group label {
                display: block;
                margin-bottom: 0.5rem;
                color: var(--white);
                font-weight: 600;
            }

            .form-group input,
            .form-group textarea {
                width: 100%;
                padding: 1rem;
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: var(--radius-sm);
                background-color: rgba(255, 255, 255, 0.1);
                color: var(--white);
                font-size: 1rem;
                transition: all var(--transition-normal);
            }

            .form-group input::placeholder,
            .form-group textarea::placeholder {
                color: rgba(255, 255, 255, 0.7);
            }

            .form-group input:focus,
            .form-group textarea:focus {
                outline: none;
                border-color: var(--white);
                background-color: rgba(255, 255, 255, 0.2);
            }

            .success-message {
                background-color: rgba(255, 255, 255, 0.2);
                border: 2px solid var(--white);
                border-radius: var(--radius-md);
                padding: 1.5rem;
                margin-top: 2rem;
                text-align: center;
            }

            .success-message i {
                font-size: 2rem;
                margin-bottom: 0.5rem;
                color: var(--white);
            }
            .stories-info {
                text-align: center;
                margin-bottom: 2rem;
            }

            .stories-info p {
                color: var(--text-light);
                font-size: 1rem;
            }

            .pagination-container {
                display: flex;
                justify-content: center;
                margin-top: 3rem;
                margin-bottom: 2rem;
            }

            .pagination {
                display: flex;
                align-items: center;
                gap: 1rem;
                background-color: var(--white);
                padding: 1rem 2rem;
                border-radius: var(--radius-lg);
                box-shadow: var(--shadow-sm);
            }

            .pagination-btn {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.75rem 1.5rem;
                border: 2px solid var(--primary);
                background-color: transparent;
                color: var(--primary);
                border-radius: var(--radius-full);
                font-weight: 600;
                cursor: pointer;
                transition: all var(--transition-normal);
            }

            .pagination-btn:hover:not(:disabled) {
                background-color: var(--primary);
                color: var(--white);
                transform: translateY(-2px);
            }

            .pagination-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                border-color: var(--text-light);
                color: var(--text-light);
            }

            .pagination-numbers {
                display: flex;
                gap: 0.5rem;
            }

            .pagination-number {
                width: 40px;
                height: 40px;
                border: 2px solid var(--border-color);
                background-color: transparent;
                color: var(--text-dark);
                border-radius: 50%;
                font-weight: 600;
                cursor: pointer;
                transition: all var(--transition-normal);
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .pagination-number:hover {
                border-color: var(--primary);
                color: var(--primary);
                transform: translateY(-2px);
            }

            .pagination-number.active {
                background-color: var(--primary);
                border-color: var(--primary);
                color: var(--white);
            }

            .pagination-ellipsis {
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--text-light);
                font-weight: bold;
            }

            @media (max-width: 768px) {
                .story-form {
                    margin: 1rem auto;
                }
                
                .pagination {
                    flex-direction: column;
                    gap: 1rem;
                    padding: 1rem;
                }
                
                .pagination-numbers {
                    order: -1;
                }
                
                .pagination-btn {
                    font-size: 0.9rem;
                    padding: 0.5rem 1rem;
                }
            }
        </style>

        <script>
            const API_URL = "http://localhost:8081";
            const STORIES_PER_PAGE = 6;
            let currentPage = 1;
            let totalStories = 0;
            let totalPages = 0;

            document.addEventListener('DOMContentLoaded', function() {
                loadStoriesFromDatabase(currentPage);
                setupPaginationEvents();
            });

            function setupPaginationEvents() {
                document.getElementById('prev-btn').addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        loadStoriesFromDatabase(currentPage);
                    }
                });

                document.getElementById('next-btn').addEventListener('click', () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        loadStoriesFromDatabase(currentPage);
                    }
                });
            }
            function loadStoriesFromDatabase(page = 1) {
                const offset = (page - 1) * STORIES_PER_PAGE;
                
                fetch(`${API_URL}/get_stories.php?limit=${STORIES_PER_PAGE}&offset=${offset}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        totalStories = data.pagination.total;
                        totalPages = Math.ceil(totalStories / STORIES_PER_PAGE);
                        
                        displayStories(data.data);
                        updateStoriesInfo(page);
                        updatePagination(page);
                    } else {
                        console.error('Failed to load stories:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error loading stories:', error);
                });
            }
            function displayStories(stories) {
                const userStoriesContainer = document.getElementById('user-stories');
                userStoriesContainer.innerHTML = '';

                if (stories.length === 0) {
                    userStoriesContainer.innerHTML = '<p style="text-align: center; color: var(--text-light); grid-column: 1 / -1;">No stories found. Be the first to share your story!</p>';
                    return;
                }

                stories.forEach(story => {
                    const storyCard = createStoryCard(story);
                    userStoriesContainer.appendChild(storyCard);
                });
            }
            function updateStoriesInfo(page) {
                const start = (page - 1) * STORIES_PER_PAGE + 1;
                const end = Math.min(page * STORIES_PER_PAGE, totalStories);
                
                const infoText = totalStories === 0 
                    ? 'No stories yet' 
                    : `Showing ${start}-${end} of ${totalStories} stories`;
                
                document.getElementById('stories-count').textContent = infoText;
            }

            function updatePagination(page) {
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');
                
                prevBtn.disabled = page <= 1;
                nextBtn.disabled = page >= totalPages;

                updatePaginationNumbers(page);
            }

            function updatePaginationNumbers(currentPage) {
                const container = document.getElementById('pagination-numbers');
                container.innerHTML = '';

                if (totalPages <= 1) {
                    return;
                }

                let startPage = Math.max(1, currentPage - 2);
                let endPage = Math.min(totalPages, currentPage + 2);

                if (startPage > 1) {
                    addPageNumber(container, 1, currentPage);
                    if (startPage > 2) {
                        addEllipsis(container);
                    }
                }
                for (let i = startPage; i <= endPage; i++) {
                    addPageNumber(container, i, currentPage);
                }

                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        addEllipsis(container);
                    }
                    addPageNumber(container, totalPages, currentPage);
                }
            }
            function addPageNumber(container, pageNum, currentPage) {
                const btn = document.createElement('button');
                btn.className = `pagination-number ${pageNum === currentPage ? 'active' : ''}`;
                btn.textContent = pageNum;
                btn.addEventListener('click', () => {
                    if (pageNum !== currentPage) {
                        currentPage = pageNum;
                        loadStoriesFromDatabase(currentPage);
                    }
                });
                container.appendChild(btn);
            }
            function addEllipsis(container) {
                const ellipsis = document.createElement('span');
                ellipsis.className = 'pagination-ellipsis';
                ellipsis.textContent = '...';
                container.appendChild(ellipsis);
            }

            function createStoryCard(story) {
                const storyCard = document.createElement('div');
                storyCard.className = 'user-story-card';
                const firstLetter = story.userName.charAt(0).toUpperCase();
                
                storyCard.innerHTML = `
                    <div class="user-story-header">
                        <div class="user-author-image">${firstLetter}</div>
                        <div class="user-author-info">
                            <h4>${story.userName}</h4>
                            <span>${story.achievement}</span>
                            <div class="user-story-date">${story.formattedDate}</div>
                        </div>
                    </div>
                    <div class="user-story-content">
                        <p>"${story.storyText}"</p>
                    </div>
                `;
                
                return storyCard;
            }

            document.getElementById('story-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const userName = document.getElementById('user-name').value;
                const achievement = document.getElementById('achievement').value;
                const storyText = document.getElementById('story-text').value;
                
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';

                fetch(`${API_URL}/submit_story.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userName: userName,
                        achievement: achievement,
                        storyText: storyText
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('success-message').style.display = 'block';
                        
                        this.reset();
                        
                        setTimeout(() => {
                            currentPage = 1;
                            loadStoriesFromDatabase(currentPage);
                        }, 1000);

                        setTimeout(() => {
                            document.getElementById('success-message').style.display = 'none';
                        }, 5000);
                    } else {
                        alert('Error: ' + (data.message || 'Failed to submit story'));
                    }
                })
                .catch(error => {
                    console.error('Error submitting story:', error);
                    alert('Connection error. Please try again.');
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                });
            });
        </script>
    </body>
</html>